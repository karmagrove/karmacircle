<p id="notice"><%= notice %></p>

<p>
  <strong>Ticket:</strong>
  <%=link_to("ticket bought for #{@ticket_purchase.ticket.price}" ,"/events/#{@event.id}/tickets/#{@ticket_purchase.ticket.id}" )%>
</p>

<p>
  <strong>Buyer email:</strong>
  <%= @ticket_purchase.buyer_email %>
</p>

<p>
  <strong>Status:</strong>
  <%= @ticket_purchase.status %>
</p>

<% if current_user and (current_user.id == @event.user_id) %>
<%= form_for(@ticket_purchase, :url => event_ticket_ticket_purchase_path(@event.id,@ticket.id,@ticket_purchase.id)) do |f| %>
<div class="field">
    <%= f.hidden_field(:status, :value => "redeemed") %>
  </div>

  <%= f.submit 'Redeem Ticket', :class => 'button left radius' %>
<% end %>

<br />
<br />
<br />
<br />
# <%= link_to 'Edit', edit_event_ticket_ticket_purchase_path(@event,@ticket,@ticket_purchase) %> |
# <%= link_to 'Back', event_ticket_ticket_purchases_path %>

<% else %>

<h3> Warning - redeeming ticket makes it invalid for future use </h3>
<%= form_for(@ticket_purchase, :url => event_ticket_ticket_purchase_path(@event.id,@ticket.id,@ticket_purchase.id)) do |f| %>
   <div class="field">
    <%= f.hidden_field(:status, :value => "redeemed") %>
  </div>
  <%= f.submit 'Redeem Ticket', :class => 'button left radius' %>
<% end %>



<% end %>



<br />

<!-- The following is a QR code generated by google.
<img src=<%="https://chart.googleapis.com/chart?chs=545x545&cht=qr&chl=#{@url}&choe=UTF-8"%> alt="QR code">
 -->
The following is a ticket for <%= @ticket_purchase.buyer_email %>

<div id="qr">

<style type="text/css">
#qr table {
  border-width: 0;
  border-style: none;
  border-color: #0000ff;
  border-collapse: collapse;
}

#qr td {
  border-left: solid 10px #000;
  padding: 0; 
  margin: 0; 
  width: 0px; 
  height: 10px; 
}

#qr td.black { border-color: #000; }
#qr td.white { border-color: #fff; }
</style>

<%= raw @qr.as_html %>
</div>